<!DOCTYPE html>
<html>
   <head>
      <title>Hello world</title>
   </head>
   <script src="/socket.io/socket.io.js"></script>
   <script>
      var socket = io();

      function setUsername() {
         socket.emit("setUsername", { username: document.getElementById("name").value, room: document.getElementById("room").value });
      }

      var user;

      socket.on("userExists", function (data) {
         document.getElementById("error-container").innerHTML = data;
      });

      socket.on("reload", function (data) {
         console.log(`  ~ data reload`, data);
         document.getElementById("message-container").innerHTML = data
            .map((item) => "<div><b>" + item.user + "</b>: " + item.message + "</div>")
            .join("");
      });

      socket.on("userSet", function (data) {
         user = data.username;
         document.body.innerHTML =
            '<input type="text" id="message">\
         <button type="button" name="button" onclick="sendMessage()">Send</button>\
         <div id="message-container"></div><button onclick="handleConnectClient()">connect client</button>';
         document.getElementById("message").focus();
      });

      function sendMessage() {
         var msg = document.getElementById("message").value;
         if (msg) {
            socket.emit("msg", { message: msg, user: user });
         }
      }

      socket.on("newmsg", function (data) {
         console.log(`  ~ data newmsg`, data);
         if (user) {
            document.getElementById("message-container").innerHTML += "<div><b>" + data.user + "</b>: " + data.message + "</div>";
         }
      });

      socket.on('clientToClient',(data) => {
         console.log(`  ~ data`, data)
       socket.emit('clientToClient',data)
      	
      })

      const handleConnectClient = () => {
         socket.emit("getSocketID");
         socket.on("getSocketID", (data) => {
            const owner = data[0].socketID;
            console.log(`  ~ owner`, owner);
            socket.to(`${owner}`).emit('clientToClient','22222222')
         });
      }; 
   </script>
   <body>
      <div id="error-container"></div>
      <input id="name" type="text" name="name" value="" placeholder="Enter your name!" />
      <select name="room" id="room">
         <option value="room1">room1</option>
         <option value="room2">room2</option>
      </select>
      <button type="button" name="button" onclick="setUsername()">Let me chat!</button>

      <script>
         document.getElementById("name").focus();
      </script>
   </body>
</html>
